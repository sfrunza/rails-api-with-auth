import{c as L,j as e,R as _,S as z,L as E,a as f,b as M,T as R,P as D,C as F,I as q,G as Q,r as u,d as V,M as A,O as U,u as k,e as I}from"./vendor-react-CM67vIbR.js";import{t as m,a as B,c as O,b as G}from"./vendor-Ccf12oly.js";import{c as W,f as H,i as $}from"./vendor-redux-CyBvHV2t.js";const J={user:null},P=W({name:"auth",initialState:J,reducers:{setUser:(s,t)=>{s.user=t.payload}}}),{setUser:g}=P.actions,pe=P.reducer,fe=s=>s.auth.user,K=H({baseUrl:"http://localhost:3001/api/v1",credentials:"include"}),X=async(s,t,a)=>{var o,n,d;const r=await K(s,t,a);return r.error&&r.error.status===401||r.data&&((n=(o=r.meta)==null?void 0:o.response)!=null&&n.headers)&&((d=r.meta.response.headers.get("Authorization"))==null||d.split(" ")[1]),r},ve=()=>s=>t=>{var a;if($(t)){const r=t.payload;console.error("RTK Query Error:",r),(r==null?void 0:r.status)===500&&m.error("Server Error! Please try again later."),console.log(r),m.error(((a=r==null?void 0:r.data)==null?void 0:a.error)||"An unexpected error occurred.")}return s(t)},Y=L({reducerPath:"authApi",baseQuery:X,endpoints:s=>({login:s.mutation({query:t=>({url:"/session",credentials:"include",method:"POST",body:t}),async onQueryStarted(t,{dispatch:a,queryFulfilled:r}){try{const o=await r;a(g(o.data.user))}catch(o){console.log("error",o)}}}),logout:s.mutation({query:()=>({url:"/session",method:"DELETE",credentials:"include"}),async onQueryStarted(t,{dispatch:a,queryFulfilled:r}){try{await r,a(g(null))}catch(o){console.log("error",o)}}}),forgotPassword:s.mutation({query:t=>({url:"/passwords",method:"POST",body:t})}),resetPassword:s.mutation({query:t=>({url:`/passwords/${t.token}`,method:"PUT",body:t})}),verify:s.mutation({query:()=>({url:"/session",method:"GET",credentials:"include"}),async onQueryStarted(t,{dispatch:a,queryFulfilled:r}){try{const o=await r;a(g(o.data))}catch(o){console.log("error",o)}}})})}),{useLoginMutation:Z,useForgotPasswordMutation:ee,useResetPasswordMutation:se,useLogoutMutation:we}=Y;function i(...s){return B(O(s))}function x({className:s,type:t,...a}){return e.jsx("input",{type:t,"data-slot":"input",className:i("border-input file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",s),...a})}function h({className:s,...t}){return e.jsx(_,{"data-slot":"label",className:i("text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",s),...t})}function v({className:s,...t}){return e.jsx("div",{"data-slot":"card",className:i("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",s),...t})}function w({className:s,...t}){return e.jsx("div",{"data-slot":"card-header",className:i("flex flex-col gap-1.5 px-6",s),...t})}function b({className:s,...t}){return e.jsx("div",{"data-slot":"card-title",className:i("leading-none font-semibold",s),...t})}function j({className:s,...t}){return e.jsx("div",{"data-slot":"card-description",className:i("text-muted-foreground text-sm",s),...t})}function y({className:s,...t}){return e.jsx("div",{"data-slot":"card-content",className:i("px-6",s),...t})}const te=G("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-[color,box-shadow] disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40",outline:"border border-input bg-background shadow-xs hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function T({className:s,variant:t,size:a,asChild:r=!1,...o}){const n=r?z:"button";return e.jsx(n,{"data-slot":"button",className:i(te({variant:t,size:a,className:s})),...o})}function re({className:s}){return e.jsx(E,{className:i("size-5 animate-spin text-inherit",s)})}function N({loading:s,children:t,className:a,...r}){return e.jsxs(T,{className:i("relative",a),...r,children:[s&&e.jsx("span",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(re,{})}),e.jsx("span",{className:s?"invisible":"",children:t})]})}function ae(){const[s,{isLoading:t}]=ee();function a(r){r.preventDefault();const o=r.currentTarget,n=o.email_address.value;s({email_address:n}).unwrap().then(d=>{m.success(d.message),o.reset()})}return e.jsxs(v,{className:"mx-auto max-w-sm",children:[e.jsxs(w,{children:[e.jsx(b,{className:"text-2xl",children:"Reset your password"}),e.jsx(j,{children:"Enter your email address and we will send you a link to reset your password."})]}),e.jsxs(y,{children:[e.jsxs("form",{className:"grid gap-4",onSubmit:a,children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"email_address",children:"Email"}),e.jsx(x,{id:"email_address",name:"email_address",type:"email",placeholder:"m@example.com",required:!0,defaultValue:"frunza.sergiu3@gmail.com",autoComplete:"off"})]}),e.jsx(N,{loading:t,disabled:t,type:"submit",className:"w-full",children:"Request password reset"})]}),e.jsxs("div",{className:"mt-4 text-sm",children:["Remebmer your password?"," ",e.jsx(f,{to:"/auth/login",className:"underline",children:"Log in"})]})]})]})}function be(){return e.jsx(ae,{})}function oe({...s}){return e.jsx(M,{"data-slot":"dropdown-menu",...s})}function ne({...s}){return e.jsx(R,{"data-slot":"dropdown-menu-trigger",...s})}function ie({className:s,sideOffset:t=4,...a}){return e.jsx(D,{children:e.jsx(F,{"data-slot":"dropdown-menu-content",sideOffset:t,className:i("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] overflow-hidden rounded-md border p-1 shadow-md",s),...a})})}function je({...s}){return e.jsx(Q,{"data-slot":"dropdown-menu-group",...s})}function p({className:s,inset:t,variant:a="default",...r}){return e.jsx(q,{"data-slot":"dropdown-menu-item","data-inset":t,"data-variant":a,className:i("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive-foreground data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/40 data-[variant=destructive]:focus:text-destructive-foreground data-[variant=destructive]:*:[svg]:!text-destructive-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...r})}const de={theme:"system",setTheme:()=>null},S=u.createContext(de);function ye({children:s,defaultTheme:t="system",storageKey:a="vite-ui-theme",...r}){const[o,n]=u.useState(()=>localStorage.getItem(a)||t);u.useEffect(()=>{const l=window.document.documentElement;if(l.classList.remove("light","dark"),o==="system"){const c=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";l.classList.add(c);return}l.classList.add(o)},[o]);const d={theme:o,setTheme:l=>{localStorage.setItem(a,l),n(l)}};return e.jsx(S.Provider,{...r,value:d,children:s})}const le=()=>{const s=u.useContext(S);if(s===void 0)throw new Error("useTheme must be used within a ThemeProvider");return s};function ce(){const{setTheme:s}=le();return e.jsxs(oe,{children:[e.jsx(ne,{asChild:!0,children:e.jsxs(T,{variant:"outline",size:"icon",children:[e.jsx(V,{className:"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"}),e.jsx(A,{className:"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),e.jsx("span",{className:"sr-only",children:"Toggle theme"})]})}),e.jsxs(ie,{align:"end",children:[e.jsx(p,{onClick:()=>s("light"),children:"Light"}),e.jsx(p,{onClick:()=>s("dark"),children:"Dark"}),e.jsx(p,{onClick:()=>s("system"),children:"System"})]})]})}function Ne(){return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute right-4 top-4 z-50",children:e.jsx(ce,{})}),e.jsxs("div",{className:"relative isolate flex min-h-svh flex-col items-center justify-center gap-6 overflow-hidden bg-muted p-6 dark:bg-background md:p-10",children:[e.jsxs("svg",{"aria-hidden":"true",className:"absolute inset-0 -z-10 size-full stroke-foreground/10 [mask-image:radial-gradient(56rem_56rem_at_center,white,transparent)]",children:[e.jsx("defs",{children:e.jsx("pattern",{x:"50%",y:-1,id:"983e3e4c-de6d-4c3f-8d64-b9761d1534cc",width:200,height:200,patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M.5 200V.5H200",fill:"none"})})}),e.jsx("rect",{fill:"url(#983e3e4c-de6d-4c3f-8d64-b9761d1534cc)",width:"100%",height:"100%",strokeWidth:0})]}),e.jsxs("div",{className:"flex w-full max-w-sm flex-col gap-6",children:[e.jsx(U,{}),e.jsxs("div",{className:"text-balance text-center text-xs text-muted-foreground",children:["By clicking continue, you agree to our"," ",e.jsx("a",{href:"#",className:"underline underline-offset-4 hover:text-primary",children:"Terms of Service"})," ","and"," ",e.jsx("a",{href:"#",className:"underline underline-offset-4 hover:text-primary",children:"Privacy Policy"}),"."]})]})]})]})}function ue(){const s=k(),[t,{isLoading:a}]=Z();async function r(o){o.preventDefault();const n=o.currentTarget,d=n.email_address.value,l=n.password.value;switch((await t({email_address:d,password:l}).unwrap()).user.role){case"admin":s("/crm",{replace:!0});break;case"manager":s("/crm",{replace:!0});break;case"customer":s("/account",{replace:!0});break;default:s("/",{replace:!0});break}}return e.jsxs(v,{className:"mx-auto max-w-sm",children:[e.jsxs(w,{children:[e.jsx(b,{className:"text-2xl",children:"Login"}),e.jsx(j,{children:"Enter your email below to login to your account."})]}),e.jsxs(y,{children:[e.jsxs("form",{className:"grid gap-4",onSubmit:r,children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"email_address",children:"Email"}),e.jsx(x,{id:"email_address",type:"email",placeholder:"m@example.com",defaultValue:"frunza.sergiu3@gmail.com",required:!0,autoComplete:"email",name:"email_address"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"password",children:"Password"}),e.jsx(x,{id:"password",type:"password",defaultValue:"111111",required:!0})]}),e.jsx(N,{loading:a,disabled:a,type:"submit",className:"w-full",children:"Login"})]}),e.jsx("div",{className:"mt-4 text-sm",children:e.jsx(f,{to:"/auth/forgot-password",className:"ml-auto inline-block text-sm underline",children:"Forgot your password?"})})]})]})}function ke(){return e.jsx(ue,{})}function me(){const s=k(),[t]=I(),a=t.get("token"),[r,{isLoading:o}]=se();async function n(d){d.preventDefault();const c=d.currentTarget.password.value;r({password:c,token:a??""}).unwrap().then(C=>{m.success(C.message),s("/auth/login")})}return e.jsxs(v,{className:"mx-auto max-w-sm",children:[e.jsxs(w,{children:[e.jsx(b,{className:"text-2xl",children:"Change your password"}),e.jsx(j,{children:"Enter a new password below to change your password."})]}),e.jsxs(y,{children:[e.jsxs("form",{className:"grid gap-4",onSubmit:n,children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"password",children:"New password"}),e.jsx(x,{id:"password",type:"password",placeholder:"New password",required:!0,defaultValue:"333333",autoComplete:"off"})]}),e.jsx(N,{loading:o,disabled:o,type:"submit",className:"w-full",children:"Change password"})]}),e.jsx("div",{className:"mt-4 text-sm",children:e.jsx(f,{to:"/auth/login",className:"underline",children:"Log in"})})]})]})}function Pe(){return e.jsx(me,{})}export{Ne as A,T as B,oe as D,be as F,ke as L,ce as M,Pe as R,re as S,ye as T,Y as a,X as b,pe as c,i as d,fe as e,ne as f,ie as g,p as h,N as i,je as j,te as k,ve as r,g as s,we as u};
