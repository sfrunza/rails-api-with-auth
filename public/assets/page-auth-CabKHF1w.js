import{t as u,a as E,c as D,j as e,S as M,b as R,R as q,d as F,T as O,P as U,C as A,I as Q,G as V,r as c}from"./vendor-CV3lS3m5.js";import{L as f,O as I,u as P,a as B}from"./vendor-router-B9UsIiAi.js";import{L as G,S as $,M as W,E as H,a as Y}from"./vendor-ui-RPHv_71o.js";import{c as J,f as K,i as X,a as T}from"./vendor-redux-DjfqBDeM.js";import{p as Z}from"./vendor-libphonenumber-js-CCC02C6p.js";import{f as ee}from"./vendor-date-fns-DfMoQYqq.js";const se={user:null},_=J({name:"auth",initialState:se,reducers:{setUser:(s,t)=>{s.user=t.payload}}}),{setUser:p}=_.actions,Te=_.reducer,_e=s=>s.auth.user,te=K({baseUrl:"http://localhost:3001/api/v1",credentials:"include"}),C=async(s,t,r)=>{var n,i,o;const a=await te(s,t,r);return a.error&&a.error.status===401||a.data&&((i=(n=a.meta)==null?void 0:n.response)!=null&&i.headers)&&((o=a.meta.response.headers.get("Authorization"))==null||o.split(" ")[1]),a},Ce=()=>s=>t=>{var r;if(X(t)){const a=t.payload;if(console.error("RTK Query Error:",a),(a==null?void 0:a.status)===422){const n=a==null?void 0:a.data;n&&typeof n=="object"&&Object.entries(n).forEach(([i,o])=>{const l=Array.isArray(o)?o.join(", "):o;u.error(`${i.split("_").join(" ")} ${l}`)})}else(a==null?void 0:a.status)===500?u.error("Server Error! Please try again later."):u.error(((r=a==null?void 0:a.data)==null?void 0:r.error)||"An unexpected error occurred.")}return s(t)},ae=T({reducerPath:"authApi",baseQuery:C,endpoints:s=>({login:s.mutation({query:t=>({url:"/session",credentials:"include",method:"POST",body:t}),async onQueryStarted(t,{dispatch:r,queryFulfilled:a}){try{const n=await a;r(p(n.data.user))}catch(n){console.log("error",n)}}}),logout:s.mutation({query:()=>({url:"/session",method:"DELETE",credentials:"include"}),async onQueryStarted(t,{dispatch:r,queryFulfilled:a}){try{await a,r(p(null))}catch(n){console.log("error",n)}}}),forgotPassword:s.mutation({query:t=>({url:"/passwords",method:"POST",body:t})}),resetPassword:s.mutation({query:t=>({url:`/passwords/${t.token}`,method:"PUT",body:t})}),verify:s.mutation({query:()=>({url:"/session",method:"GET",credentials:"include"}),async onQueryStarted(t,{dispatch:r,queryFulfilled:a}){try{const n=await a;r(p(n.data))}catch(n){r(p(null)),console.log("error",n)}}})})}),{useLoginMutation:re,useForgotPasswordMutation:ne,useResetPasswordMutation:oe,useLogoutMutation:Le}=ae,ie=T({reducerPath:"settingsApi",baseQuery:C,tagTypes:["Setting"],endpoints:s=>({getSettings:s.query({query:()=>"/settings",providesTags:["Setting"]}),bulkUpdateSettings:s.mutation({query:({data:t})=>({url:"/settings/bulk_update",method:"POST",body:{setting:t}}),invalidatesTags:(t,r)=>r?[]:["Setting"]}),updateLogo:s.mutation({query:({image:t})=>{const r=new FormData;return r.append("setting[company_logo]",t),{url:"/settings/bulk_update",method:"POST",body:r}},invalidatesTags:["Setting"]})})}),{useGetSettingsQuery:de,useBulkUpdateSettingsMutation:ze,useUpdateLogoMutation:Ee}=ie,le="US";function d(...s){return E(D(s))}function De(s){if(!s)return"";const t=Z(s,le);return t?t.formatNational():s}function Me(s){if(!s)return"TBD";const t=new Date(s),r=new Date(t.valueOf()+t.getTimezoneOffset()*60*1e3);return ee(r,"PPP")}function Re(s,t){const a=[];if(t<=5){for(let o=1;o<=t;o++)a.push(o);return a}else a.push(1);s>3&&a.push("...");const n=Math.max(2,s-1),i=Math.min(t-1,s+1);for(let o=n;o<=i;o++)a.push(o);return s<t-2&&a.push("..."),a.push(t),a}const ce=R("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-[color,box-shadow] disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40",outline:"border border-input bg-background shadow-xs hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function x({className:s,variant:t,size:r,asChild:a=!1,...n}){const i=a?M:"button";return e.jsx(i,{"data-slot":"button",className:d(ce({variant:t,size:r,className:s})),...n})}function ue({className:s}){return e.jsx(G,{className:d("size-5 animate-spin text-inherit",s)})}function v({loading:s,children:t,className:r,...a}){return e.jsxs(x,{className:d("relative",r),...a,children:[s&&e.jsx("span",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(ue,{})}),e.jsx("span",{className:s?"invisible":"",children:t})]})}function w({className:s,...t}){return e.jsx("div",{"data-slot":"card",className:d("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",s),...t})}function y({className:s,...t}){return e.jsx("div",{"data-slot":"card-header",className:d("flex flex-col gap-1.5 px-6",s),...t})}function j({className:s,...t}){return e.jsx("div",{"data-slot":"card-title",className:d("leading-none font-semibold text-lg",s),...t})}function b({className:s,...t}){return e.jsx("div",{"data-slot":"card-description",className:d("text-muted-foreground text-sm",s),...t})}function N({className:s,...t}){return e.jsx("div",{"data-slot":"card-content",className:d("px-6",s),...t})}function qe({className:s,...t}){return e.jsx("div",{"data-slot":"card-footer",className:d("flex items-center px-6",s),...t})}function k({className:s,type:t,...r}){return e.jsx("input",{type:t,"data-slot":"input",className:d("border-input file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",s),...r})}function h({className:s,...t}){return e.jsx(q,{"data-slot":"label",className:d("text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",s),...t})}function me(){const[s,{isLoading:t}]=ne();function r(a){a.preventDefault();const n=a.currentTarget,i=n.email_address.value;s({email_address:i}).unwrap().then(o=>{u.success(o.message),n.reset()})}return e.jsxs(w,{className:"mx-auto max-w-sm",children:[e.jsxs(y,{children:[e.jsx(j,{className:"text-2xl",children:"Reset your password"}),e.jsx(b,{children:"Enter your email address and we will send you a link to reset your password."})]}),e.jsxs(N,{children:[e.jsxs("form",{className:"grid gap-4",onSubmit:r,children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"email_address",children:"Email"}),e.jsx(k,{id:"email_address",name:"email_address",type:"email",placeholder:"m@example.com",required:!0,defaultValue:"frunza.sergiu3@gmail.com",autoComplete:"off"})]}),e.jsx(v,{loading:t,disabled:t,type:"submit",className:"w-full",children:"Request password reset"})]}),e.jsxs("div",{className:"mt-4 text-sm",children:["Remebmer your password?"," ",e.jsx(f,{to:"/auth/login",className:"underline",children:"Log in"})]})]})]})}function Fe(){return e.jsx(me,{})}function pe({...s}){return e.jsx(F,{"data-slot":"dropdown-menu",...s})}function he({...s}){return e.jsx(O,{"data-slot":"dropdown-menu-trigger",...s})}function ge({className:s,sideOffset:t=4,...r}){return e.jsx(U,{children:e.jsx(A,{"data-slot":"dropdown-menu-content",sideOffset:t,className:d("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] overflow-hidden rounded-md border p-1 shadow-md",s),...r})})}function Oe({...s}){return e.jsx(V,{"data-slot":"dropdown-menu-group",...s})}function g({className:s,inset:t,variant:r="default",...a}){return e.jsx(Q,{"data-slot":"dropdown-menu-item","data-inset":t,"data-variant":r,className:d("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive-foreground data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/40 data-[variant=destructive]:focus:text-destructive-foreground data-[variant=destructive]:*:[svg]:!text-destructive-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...a})}const fe={theme:"system",setTheme:()=>null},L=c.createContext(fe);function Ue({children:s,defaultTheme:t="system",storageKey:r="vite-ui-theme",...a}){const[n,i]=c.useState(()=>localStorage.getItem(r)||t);c.useEffect(()=>{const l=window.document.documentElement;if(l.classList.remove("light","dark"),n==="system"){const m=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";l.classList.add(m);return}l.classList.add(n)},[n]);const o={theme:n,setTheme:l=>{localStorage.setItem(r,l),i(l)}};return e.jsx(L.Provider,{...a,value:o,children:s})}const xe=()=>{const s=c.useContext(L);if(s===void 0)throw new Error("useTheme must be used within a ThemeProvider");return s};function ve(){const{setTheme:s}=xe();return e.jsxs(pe,{children:[e.jsx(he,{asChild:!0,children:e.jsxs(x,{variant:"outline",size:"icon",children:[e.jsx($,{className:"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"}),e.jsx(W,{className:"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),e.jsx("span",{className:"sr-only",children:"Toggle theme"})]})}),e.jsxs(ge,{align:"end",children:[e.jsx(g,{onClick:()=>s("light"),children:"Light"}),e.jsx(g,{onClick:()=>s("dark"),children:"Dark"}),e.jsx(g,{onClick:()=>s("system"),children:"System"})]})]})}function Ae(){const{data:s}=de(),t=s==null?void 0:s.company_name,r=s==null?void 0:s.company_logo;return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute right-4 top-4 z-50",children:e.jsx(ve,{})}),e.jsxs("div",{className:"relative isolate flex min-h-svh flex-col items-center justify-center gap-6 overflow-hidden bg-muted p-6 dark:bg-background md:p-10",children:[e.jsxs("svg",{"aria-hidden":"true",className:"absolute inset-0 -z-10 size-full stroke-foreground/10 [mask-image:radial-gradient(56rem_56rem_at_center,white,transparent)]",children:[e.jsx("defs",{children:e.jsx("pattern",{x:"50%",y:-1,id:"983e3e4c-de6d-4c3f-8d64-b9761d1534cc",width:200,height:200,patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M.5 200V.5H200",fill:"none"})})}),e.jsx("rect",{fill:"url(#983e3e4c-de6d-4c3f-8d64-b9761d1534cc)",width:"100%",height:"100%",strokeWidth:0})]}),e.jsxs("div",{className:"flex w-full max-w-sm flex-col gap-6",children:[e.jsx("div",{className:"flex h-12 items-center gap-2 self-center font-medium",children:s&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:r,alt:"Company logo",className:"size-12"}),t]})}),e.jsx(I,{}),e.jsxs("div",{className:"text-balance text-center text-xs text-muted-foreground",children:["By clicking continue, you agree to our"," ",e.jsx("a",{href:"#",className:"underline underline-offset-4 hover:text-primary",children:"Terms of Service"})," ","and"," ",e.jsx("a",{href:"#",className:"underline underline-offset-4 hover:text-primary",children:"Privacy Policy"}),"."]})]})]})]})}const S=c.forwardRef(({className:s,disabled:t,...r},a)=>{const[n,i]=c.useState(!1);return e.jsxs("div",{className:d("relative rounded-md",s),children:[e.jsx(k,{type:n?"text":"password",ref:a,disabled:t,...r}),e.jsx(x,{type:"button",size:"icon",variant:"ghost",disabled:t,className:"absolute right-1 top-1/2 size-7 -translate-y-1/2 rounded-md text-muted-foreground",onClick:()=>i(o=>!o),children:n?e.jsx(H,{}):e.jsx(Y,{})})]})});S.displayName="PasswordInput";function we(){const s=P(),[t,{isLoading:r}]=re();async function a(n){n.preventDefault();const i=n.currentTarget,o=i.email_address.value,l=i.password.value;switch((await t({email_address:o,password:l}).unwrap()).user.role){case"admin":s("/crm",{replace:!0});break;case"manager":s("/crm",{replace:!0});break;case"customer":s("/account",{replace:!0});break;default:s("/",{replace:!0});break}}return e.jsxs(w,{className:"mx-auto max-w-sm",children:[e.jsxs(y,{children:[e.jsx(j,{className:"text-2xl",children:"Login"}),e.jsx(b,{children:"Enter your email below to login to your account."})]}),e.jsxs(N,{children:[e.jsxs("form",{className:"grid gap-4",onSubmit:a,children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"email_address",children:"Email"}),e.jsx(k,{id:"email_address",type:"email",placeholder:"m@example.com",defaultValue:"frunza.sergiu3@gmail.com",required:!0,autoComplete:"email",name:"email_address"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"password",children:"Password"}),e.jsx(S,{id:"password",defaultValue:"111111",required:!0})]}),e.jsx(v,{loading:r,disabled:r,type:"submit",className:"w-full",children:"Login"})]}),e.jsx("div",{className:"mt-4 text-sm",children:e.jsx(f,{to:"/auth/forgot-password",className:"ml-auto inline-block text-sm underline",children:"Forgot your password?"})})]})]})}function Qe(){return e.jsx(we,{})}function ye(){const s=P(),[t]=B(),r=t.get("token"),[a,{isLoading:n}]=oe();async function i(o){o.preventDefault();const m=o.currentTarget.password.value;a({password:m,token:r??""}).unwrap().then(z=>{u.success(z.message),s("/auth/login")})}return e.jsxs(w,{className:"mx-auto max-w-sm",children:[e.jsxs(y,{children:[e.jsx(j,{className:"text-2xl",children:"Change your password"}),e.jsx(b,{children:"Enter a new password below to change your password."})]}),e.jsxs(N,{children:[e.jsxs("form",{className:"grid gap-4",onSubmit:i,children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"password",children:"New password"}),e.jsx(S,{id:"password",placeholder:"New password",required:!0,defaultValue:"333333",autoComplete:"off"})]}),e.jsx(v,{loading:n,disabled:n,type:"submit",className:"w-full",children:"Change password"})]}),e.jsx("div",{className:"mt-4 text-sm",children:e.jsx(f,{to:"/auth/login",className:"underline",children:"Log in"})})]})]})}function Ve(){return e.jsx(ye,{})}export{Ae as A,x as B,w as C,pe as D,Fe as F,k as I,h as L,ve as M,S as P,Ve as R,ue as S,Ue as T,ae as a,C as b,Te as c,d,ce as e,v as f,N as g,y as h,qe as i,De as j,de as k,Ee as l,j as m,Me as n,Re as o,Qe as p,_e as q,Ce as r,ie as s,Le as t,ze as u,he as v,ge as w,g as x,Oe as y};
