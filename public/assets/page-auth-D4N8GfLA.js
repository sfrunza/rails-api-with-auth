import{t as c,a as z,c as E,j as e,R as M,b as R,S as q,d as F,T as D,P as U,C as A,I as Q,G as O,r as g}from"./vendor-Oy3yQvpb.js";import{L as f,O as V,u as k,a as I}from"./vendor-router-BOglXYhN.js";import{L as B,S as G,M as $}from"./vendor-ui-BiEMLtw4.js";import{c as W,f as H,i as Y,a as S}from"./vendor-redux-BIS1gR2s.js";import{p as J}from"./vendor-libphonenumber-js-1k7QeoIm.js";const K={user:null},P=W({name:"auth",initialState:K,reducers:{setUser:(s,t)=>{s.user=t.payload}}}),{setUser:m}=P.actions,ye=P.reducer,Ne=s=>s.auth.user,X=H({baseUrl:"http://localhost:3001/api/v1",credentials:"include"}),T=async(s,t,r)=>{var o,n,i;const a=await X(s,t,r);return a.error&&a.error.status===401||a.data&&((n=(o=a.meta)==null?void 0:o.response)!=null&&n.headers)&&((i=a.meta.response.headers.get("Authorization"))==null||i.split(" ")[1]),a},ke=()=>s=>t=>{var r;if(Y(t)){const a=t.payload;if(console.error("RTK Query Error:",a),(a==null?void 0:a.status)===422){const o=a==null?void 0:a.data;o&&typeof o=="object"&&Object.entries(o).forEach(([n,i])=>{const l=Array.isArray(i)?i.join(", "):i;c.error(`${n.split("_").join(" ")} ${l}`)})}else(a==null?void 0:a.status)===500?c.error("Server Error! Please try again later."):c.error(((r=a==null?void 0:a.data)==null?void 0:r.error)||"An unexpected error occurred.")}return s(t)},Z=S({reducerPath:"authApi",baseQuery:T,endpoints:s=>({login:s.mutation({query:t=>({url:"/session",credentials:"include",method:"POST",body:t}),async onQueryStarted(t,{dispatch:r,queryFulfilled:a}){try{const o=await a;r(m(o.data.user))}catch(o){console.log("error",o)}}}),logout:s.mutation({query:()=>({url:"/session",method:"DELETE",credentials:"include"}),async onQueryStarted(t,{dispatch:r,queryFulfilled:a}){try{await a,r(m(null))}catch(o){console.log("error",o)}}}),forgotPassword:s.mutation({query:t=>({url:"/passwords",method:"POST",body:t})}),resetPassword:s.mutation({query:t=>({url:`/passwords/${t.token}`,method:"PUT",body:t})}),verify:s.mutation({query:()=>({url:"/session",method:"GET",credentials:"include"}),async onQueryStarted(t,{dispatch:r,queryFulfilled:a}){try{const o=await a;r(m(o.data))}catch(o){r(m(null)),console.log("error",o)}}})})}),{useLoginMutation:ee,useForgotPasswordMutation:se,useResetPasswordMutation:te,useLogoutMutation:Se}=Z,ae=S({reducerPath:"settingsApi",baseQuery:T,tagTypes:["Setting"],endpoints:s=>({getSettings:s.query({query:()=>"/settings",providesTags:["Setting"]}),bulkUpdateSettings:s.mutation({query:({data:t})=>({url:"/settings/bulk_update",method:"POST",body:{setting:t}}),invalidatesTags:(t,r)=>r?[]:["Setting"]}),updateLogo:s.mutation({query:({data:t})=>({url:"/settings/bulk_update",method:"POST",body:t}),invalidatesTags:["Setting"]})})}),{useGetSettingsQuery:re,useBulkUpdateSettingsMutation:Pe,useUpdateLogoMutation:Te}=ae,oe="US";function d(...s){return z(E(s))}function _e(s){if(!s)return"";const t=J(s,oe);return t?t.formatNational():s}function p({className:s,type:t,...r}){return e.jsx("input",{type:t,"data-slot":"input",className:d("border-input file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",s),...r})}function h({className:s,...t}){return e.jsx(M,{"data-slot":"label",className:d("text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",s),...t})}function v({className:s,...t}){return e.jsx("div",{"data-slot":"card",className:d("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",s),...t})}function w({className:s,...t}){return e.jsx("div",{"data-slot":"card-header",className:d("flex flex-col gap-1.5 px-6",s),...t})}function b({className:s,...t}){return e.jsx("div",{"data-slot":"card-title",className:d("leading-none font-semibold text-lg",s),...t})}function j({className:s,...t}){return e.jsx("div",{"data-slot":"card-description",className:d("text-muted-foreground text-sm",s),...t})}function y({className:s,...t}){return e.jsx("div",{"data-slot":"card-content",className:d("px-6",s),...t})}function Ce({className:s,...t}){return e.jsx("div",{"data-slot":"card-footer",className:d("flex items-center px-6",s),...t})}const ne=R("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-[color,box-shadow] disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40",outline:"border border-input bg-background shadow-xs hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function _({className:s,variant:t,size:r,asChild:a=!1,...o}){const n=a?q:"button";return e.jsx(n,{"data-slot":"button",className:d(ne({variant:t,size:r,className:s})),...o})}function ie({className:s}){return e.jsx(B,{className:d("size-5 animate-spin text-inherit",s)})}function N({loading:s,children:t,className:r,...a}){return e.jsxs(_,{className:d("relative",r),...a,children:[s&&e.jsx("span",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(ie,{})}),e.jsx("span",{className:s?"invisible":"",children:t})]})}function de(){const[s,{isLoading:t}]=se();function r(a){a.preventDefault();const o=a.currentTarget,n=o.email_address.value;s({email_address:n}).unwrap().then(i=>{c.success(i.message),o.reset()})}return e.jsxs(v,{className:"mx-auto max-w-sm",children:[e.jsxs(w,{children:[e.jsx(b,{className:"text-2xl",children:"Reset your password"}),e.jsx(j,{children:"Enter your email address and we will send you a link to reset your password."})]}),e.jsxs(y,{children:[e.jsxs("form",{className:"grid gap-4",onSubmit:r,children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"email_address",children:"Email"}),e.jsx(p,{id:"email_address",name:"email_address",type:"email",placeholder:"m@example.com",required:!0,defaultValue:"frunza.sergiu3@gmail.com",autoComplete:"off"})]}),e.jsx(N,{loading:t,disabled:t,type:"submit",className:"w-full",children:"Request password reset"})]}),e.jsxs("div",{className:"mt-4 text-sm",children:["Remebmer your password?"," ",e.jsx(f,{to:"/auth/login",className:"underline",children:"Log in"})]})]})]})}function Le(){return e.jsx(de,{})}function le({...s}){return e.jsx(F,{"data-slot":"dropdown-menu",...s})}function ce({...s}){return e.jsx(D,{"data-slot":"dropdown-menu-trigger",...s})}function ue({className:s,sideOffset:t=4,...r}){return e.jsx(U,{children:e.jsx(A,{"data-slot":"dropdown-menu-content",sideOffset:t,className:d("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] overflow-hidden rounded-md border p-1 shadow-md",s),...r})})}function ze({...s}){return e.jsx(O,{"data-slot":"dropdown-menu-group",...s})}function x({className:s,inset:t,variant:r="default",...a}){return e.jsx(Q,{"data-slot":"dropdown-menu-item","data-inset":t,"data-variant":r,className:d("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive-foreground data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/40 data-[variant=destructive]:focus:text-destructive-foreground data-[variant=destructive]:*:[svg]:!text-destructive-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...a})}const me={theme:"system",setTheme:()=>null},C=g.createContext(me);function Ee({children:s,defaultTheme:t="system",storageKey:r="vite-ui-theme",...a}){const[o,n]=g.useState(()=>localStorage.getItem(r)||t);g.useEffect(()=>{const l=window.document.documentElement;if(l.classList.remove("light","dark"),o==="system"){const u=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";l.classList.add(u);return}l.classList.add(o)},[o]);const i={theme:o,setTheme:l=>{localStorage.setItem(r,l),n(l)}};return e.jsx(C.Provider,{...a,value:i,children:s})}const ge=()=>{const s=g.useContext(C);if(s===void 0)throw new Error("useTheme must be used within a ThemeProvider");return s};function pe(){const{setTheme:s}=ge();return e.jsxs(le,{children:[e.jsx(ce,{asChild:!0,children:e.jsxs(_,{variant:"outline",size:"icon",children:[e.jsx(G,{className:"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"}),e.jsx($,{className:"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),e.jsx("span",{className:"sr-only",children:"Toggle theme"})]})}),e.jsxs(ue,{align:"end",children:[e.jsx(x,{onClick:()=>s("light"),children:"Light"}),e.jsx(x,{onClick:()=>s("dark"),children:"Dark"}),e.jsx(x,{onClick:()=>s("system"),children:"System"})]})]})}function Me(){const{data:s}=re(),t=s==null?void 0:s.company_name,r=s==null?void 0:s.company_logo;return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute right-4 top-4 z-50",children:e.jsx(pe,{})}),e.jsxs("div",{className:"relative isolate flex min-h-svh flex-col items-center justify-center gap-6 overflow-hidden bg-muted p-6 dark:bg-background md:p-10",children:[e.jsxs("svg",{"aria-hidden":"true",className:"absolute inset-0 -z-10 size-full stroke-foreground/10 [mask-image:radial-gradient(56rem_56rem_at_center,white,transparent)]",children:[e.jsx("defs",{children:e.jsx("pattern",{x:"50%",y:-1,id:"983e3e4c-de6d-4c3f-8d64-b9761d1534cc",width:200,height:200,patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M.5 200V.5H200",fill:"none"})})}),e.jsx("rect",{fill:"url(#983e3e4c-de6d-4c3f-8d64-b9761d1534cc)",width:"100%",height:"100%",strokeWidth:0})]}),e.jsxs("div",{className:"flex w-full max-w-sm flex-col gap-6",children:[e.jsx("div",{className:"flex h-12 items-center gap-2 self-center font-medium",children:s&&e.jsxs(e.Fragment,{children:[e.jsx("img",{src:r,alt:"Company logo",className:"size-12"}),t]})}),e.jsx(V,{}),e.jsxs("div",{className:"text-balance text-center text-xs text-muted-foreground",children:["By clicking continue, you agree to our"," ",e.jsx("a",{href:"#",className:"underline underline-offset-4 hover:text-primary",children:"Terms of Service"})," ","and"," ",e.jsx("a",{href:"#",className:"underline underline-offset-4 hover:text-primary",children:"Privacy Policy"}),"."]})]})]})]})}function he(){const s=k(),[t,{isLoading:r}]=ee();async function a(o){o.preventDefault();const n=o.currentTarget,i=n.email_address.value,l=n.password.value;switch((await t({email_address:i,password:l}).unwrap()).user.role){case"admin":s("/crm",{replace:!0});break;case"manager":s("/crm",{replace:!0});break;case"customer":s("/account",{replace:!0});break;default:s("/",{replace:!0});break}}return e.jsxs(v,{className:"mx-auto max-w-sm",children:[e.jsxs(w,{children:[e.jsx(b,{className:"text-2xl",children:"Login"}),e.jsx(j,{children:"Enter your email below to login to your account."})]}),e.jsxs(y,{children:[e.jsxs("form",{className:"grid gap-4",onSubmit:a,children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"email_address",children:"Email"}),e.jsx(p,{id:"email_address",type:"email",placeholder:"m@example.com",defaultValue:"frunza.sergiu3@gmail.com",required:!0,autoComplete:"email",name:"email_address"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"password",children:"Password"}),e.jsx(p,{id:"password",type:"password",defaultValue:"111111",required:!0})]}),e.jsx(N,{loading:r,disabled:r,type:"submit",className:"w-full",children:"Login"})]}),e.jsx("div",{className:"mt-4 text-sm",children:e.jsx(f,{to:"/auth/forgot-password",className:"ml-auto inline-block text-sm underline",children:"Forgot your password?"})})]})]})}function Re(){return e.jsx(he,{})}function xe(){const s=k(),[t]=I(),r=t.get("token"),[a,{isLoading:o}]=te();async function n(i){i.preventDefault();const u=i.currentTarget.password.value;a({password:u,token:r??""}).unwrap().then(L=>{c.success(L.message),s("/auth/login")})}return e.jsxs(v,{className:"mx-auto max-w-sm",children:[e.jsxs(w,{children:[e.jsx(b,{className:"text-2xl",children:"Change your password"}),e.jsx(j,{children:"Enter a new password below to change your password."})]}),e.jsxs(y,{children:[e.jsxs("form",{className:"grid gap-4",onSubmit:n,children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(h,{htmlFor:"password",children:"New password"}),e.jsx(p,{id:"password",type:"password",placeholder:"New password",required:!0,defaultValue:"333333",autoComplete:"off"})]}),e.jsx(N,{loading:o,disabled:o,type:"submit",className:"w-full",children:"Change password"})]}),e.jsx("div",{className:"mt-4 text-sm",children:e.jsx(f,{to:"/auth/login",className:"underline",children:"Log in"})})]})]})}function qe(){return e.jsx(xe,{})}export{Me as A,_ as B,v as C,le as D,Le as F,p as I,h as L,pe as M,qe as R,ie as S,Ee as T,ne as a,T as b,d as c,N as d,y as e,w as f,Ce as g,_e as h,re as i,Te as j,b as k,Z as l,ye as m,Re as n,Ne as o,Se as p,ce as q,ke as r,ae as s,ue as t,Pe as u,x as v,ze as w};
